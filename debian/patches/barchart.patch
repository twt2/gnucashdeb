Description: Barcharts were incorrectly displayed
Origin: upstream,
        https://github.com/Gnucash/gnucash/commit/96289823e5a7b7904bf9e64fe94bcb1dbcb0c7ee
        https://github.com/Gnucash/gnucash/commit/6d0a3707e1f6cc0d8ca00a5a96fe0e9355bcbb61
        https://github.com/Gnucash/gnucash/commit/00b827dbf255d8c29c4c296e10a7baf4ee172cfe
Bug: https://bugzilla.gnome.org/show_bug.cgi?id=737815
Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=765412
Last-Update: 2014-10-17
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/src/report/report-system/html-barchart.scm
+++ b/src/report/report-system/html-barchart.scm
@@ -386,7 +386,7 @@
             (push (gnc:html-js-include "jqplot/jquery.jqplot.js"))
             (push (gnc:html-js-include "jqplot/jqplot.barRenderer.js"))
             (push (gnc:html-js-include "jqplot/jqplot.cursor.js"))
-            (push (gnc:html-js-include "jqplot/jqplot.dateAxisRenderer.js"))
+            (push (gnc:html-js-include "jqplot/jqplot.categoryAxisRenderer.js"))
             (push (gnc:html-js-include "jqplot/jqplot.highlighter.js"))
             (push (gnc:html-js-include "jqplot/jqplot.canvasTextRenderer.js"))
             (push (gnc:html-js-include "jqplot/jqplot.canvasAxisTickRenderer.js"))
@@ -421,7 +421,7 @@
                     data)
                   (series-data-end col (list-ref-safe (gnc:html-barchart-col-labels barchart) col))
                   (if (< col (- cols 1))
-                      (loop (+ 1 col) 1)))))
+                      (loop (+ 1 col) 0)))))
 
 
             (push "var options = {
@@ -445,7 +445,7 @@
                    },
                    axes: {
                        xaxis: {
-                           renderer:$.jqplot.DateAxisRenderer,
+                           renderer:$.jqplot.CategoryAxisRenderer,
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer,
                            tickOptions: {
                                angle: -30,
@@ -456,8 +456,12 @@
                            autoscale: true,
                        },
                    },
+                   highlighter: {
+                       tooltipContentEditor: formatTooltip,
+                   },
                    cursor:{
                        show: true,
+                       showTooltip: false,
                        zoom: true
                    }
                 };\n")
@@ -495,12 +499,9 @@
             (push "var plot = $.jqplot('")(push chart-id)(push"', data, options);
 
   function formatTooltip(str, seriesIndex, pointIndex) {
-      if (options.axes.xaxis.ticks[pointIndex] !== undefined)
-          x = options.axes.xaxis.ticks[pointIndex];
-      else
-          x = pointIndex;
+      x = data[seriesIndex][pointIndex][0];
       y = data[seriesIndex][pointIndex][1].toFixed(2);
-      return options.series[seriesIndex].label + ' ' + x + '<br><b>' + y + '</b>';
+      return options.series[seriesIndex].label + '<br/>' + x + '<br/><b>' + y + '</b>';
   }\n") 
 
             (push "});\n</script>")
