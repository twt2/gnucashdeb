Description: Add full path of gnucash-env inside gnucash-make-guids script
 Without this patch, gnucash-make-guids fails because it does not find
 gnucash-env in the PATH.
 .
 The bugfix involves the generation of the gnucash-make-guids script at build
 time.
Author: SÃ©bastien Villemot <sebastien@debian.org>
Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=691503
Forwarded: https://bugzilla.gnome.org/show_bug.cgi?id=687144
Last-Update: 2012-10-29
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/src/bin/overrides/gnucash-make-guids
+++ /dev/null
@@ -1,36 +0,0 @@
-#!/bin/sh
-exec gnucash-env guile -s "$0" "$@"
-!#
-
-(define (usage)
-  (display "Usage: gnucash-make-guids [number-to-make (default is 100)]\n")
-  (exit 1))
-
-(define args (cdr (program-arguments)))
-(define num-to-make 100)
-
-;; Too many arguments
-(if (> (length args) 1)
-    (usage))
-
-(if (= (length args) 1)
-    (let ((arg (string->number (car args))))
-      (if (not (number? arg))
-          (usage))
-      (set! arg (inexact->exact arg))
-      (if (<= arg 0)
-          (usage))
-      (set! num-to-make arg)))
-
-(use-modules (gnucash gnc-module))
-(gnc:module-system-init)
-(gnc:module-load "gnucash/engine" 0)
-
-(let loop ((remaining num-to-make))
-  (display (guid-new-return)) (newline)
-  (if (> remaining 1)
-      (loop (- remaining 1))))
-
-;; Local Variables:
-;; mode: scheme
-;; End:
--- /dev/null
+++ b/src/bin/overrides/gnucash-make-guids.in
@@ -0,0 +1,36 @@
+#!/bin/sh
+exec @-GNC_LIB_INSTALLDIR-@/overrides/gnucash-env guile -s "$0" "$@"
+!#
+
+(define (usage)
+  (display "Usage: gnucash-make-guids [number-to-make (default is 100)]\n")
+  (exit 1))
+
+(define args (cdr (program-arguments)))
+(define num-to-make 100)
+
+;; Too many arguments
+(if (> (length args) 1)
+    (usage))
+
+(if (= (length args) 1)
+    (let ((arg (string->number (car args))))
+      (if (not (number? arg))
+          (usage))
+      (set! arg (inexact->exact arg))
+      (if (<= arg 0)
+          (usage))
+      (set! num-to-make arg)))
+
+(use-modules (gnucash gnc-module))
+(gnc:module-system-init)
+(gnc:module-load "gnucash/engine" 0)
+
+(let loop ((remaining num-to-make))
+  (display (guid-new-return)) (newline)
+  (if (> remaining 1)
+      (loop (- remaining 1))))
+
+;; Local Variables:
+;; mode: scheme
+;; End:
--- a/src/bin/overrides/Makefile.am
+++ b/src/bin/overrides/Makefile.am
@@ -8,7 +8,7 @@
 EXTRA_DIST = \
   gnucash-env.in \
   gnucash-build-env.in \
-  gnucash-make-guids \
+  gnucash-make-guids.in \
   guile.in 
 
 noinst_DATA = gnucash-build-env
@@ -48,3 +48,11 @@
 	mv $@.tmp $@
 	chmod u+x $@
 CLEANFILES += gnucash-build-env
+
+gnucash-make-guids: gnucash-make-guids.in ${top_builddir}/config.status Makefile
+	rm -f $@.tmp
+	sed < $< > $@.tmp \
+            -e 's#@-GNC_LIB_INSTALLDIR-@#${libdir}#'
+	mv $@.tmp $@
+	chmod u+x $@
+CLEANFILES += gnucash-make-guids
